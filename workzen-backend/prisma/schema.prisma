generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model attendance {
  id            Int                      @id @default(autoincrement())
  user_id       Int?
  date          DateTime                 @db.Date
  status        String                   @db.VarChar(20)
  check_in      DateTime?                @db.Time(6)
  check_out     DateTime?                @db.Time(6)
  working_hours Unsupported("interval")? @default(dbgenerated("(check_out - check_in)"))
  users         users?                   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, date], map: "unique_attendance")
  @@index([user_id, date], map: "idx_attendance_user_date")
}

model audit_logs {
  id        Int       @id @default(autoincrement())
  user_id   Int?
  action    String    @db.VarChar(100)
  details   String?
  timestamp DateTime? @default(now()) @db.Timestamp(6)
  users     users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)
}

model departments {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(100)
  description String?
  users       users[]
}

model designations {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(100)
  description String?
  users       users[]
}

model leave_types {
  id            Int      @id @default(autoincrement())
  name          String   @unique @db.VarChar(50)
  max_days      Int?     @default(0)
  carry_forward Boolean? @default(false)
  leaves        leaves[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model leaves {
  id                              Int          @id @default(autoincrement())
  user_id                         Int?
  leave_type_id                   Int?
  start_date                      DateTime     @db.Date
  end_date                        DateTime     @db.Date
  reason                          String?
  status                          String?      @default("Pending") @db.VarChar(20)
  approved_by                     Int?
  requested_at                    DateTime?    @default(now()) @db.Timestamp(6)
  users_leaves_approved_byTousers users?       @relation("leaves_approved_byTousers", fields: [approved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  leave_types                     leave_types? @relation(fields: [leave_type_id], references: [id], onUpdate: NoAction)
  users_leaves_user_idTousers     users?       @relation("leaves_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model notifications {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  message    String
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model payroll {
  id                Int                 @id @default(autoincrement())
  user_id           Int?
  month             String              @db.VarChar(20)
  basic_salary      Decimal             @db.Decimal(10, 2)
  pf_contribution   Decimal?            @default(0) @db.Decimal(10, 2)
  professional_tax  Decimal?            @default(0) @db.Decimal(10, 2)
  deductions        Decimal?            @default(0) @db.Decimal(10, 2)
  bonuses           Decimal?            @default(0) @db.Decimal(10, 2)
  net_salary        Decimal?            @default(dbgenerated("((((basic_salary + bonuses) - pf_contribution) - professional_tax) - deductions)")) @db.Decimal(10, 2)
  processed_date    DateTime?           @default(dbgenerated("CURRENT_DATE")) @db.Date
  users             users?              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  payslips          payslips[]
  salary_components salary_components[]
}

model payslips {
  id           Int       @id @default(autoincrement())
  payroll_id   Int?
  file_url     String?
  generated_on DateTime? @default(now()) @db.Timestamp(6)
  payroll      payroll?  @relation(fields: [payroll_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model roles {
  id          Int     @id @default(autoincrement())
  name        String  @unique @db.VarChar(50)
  description String?
  users       users[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model salary_components {
  id             Int      @id @default(autoincrement())
  payroll_id     Int?
  component_name String?  @db.VarChar(100)
  amount         Decimal? @db.Decimal(10, 2)
  type           String?  @db.VarChar(20)
  payroll        payroll? @relation(fields: [payroll_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id                               Int             @id @default(autoincrement())
  name                             String          @db.VarChar(100)
  email                            String          @unique @db.VarChar(100)
  password_hash                    String
  role_id                          Int?
  department_id                    Int?
  designation_id                   Int?
  join_date                        DateTime?       @default(dbgenerated("CURRENT_DATE")) @db.Date
  base_salary                      Decimal?        @default(0) @db.Decimal(10, 2)
  phone                            String?         @db.VarChar(20)
  address                          String?
  profile_image                    String?
  is_active                        Boolean?        @default(true)
  created_at                       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at                       DateTime?       @default(now()) @db.Timestamp(6)
  attendance                       attendance[]
  audit_logs                       audit_logs[]
  leaves_leaves_approved_byTousers leaves[]        @relation("leaves_approved_byTousers")
  leaves_leaves_user_idTousers     leaves[]        @relation("leaves_user_idTousers")
  notifications                    notifications[]
  payroll                          payroll[]
  departments                      departments?    @relation(fields: [department_id], references: [id], onUpdate: NoAction)
  designations                     designations?   @relation(fields: [designation_id], references: [id], onUpdate: NoAction)
  roles                            roles?          @relation(fields: [role_id], references: [id], onUpdate: NoAction)

  @@index([role_id], map: "idx_user_role")
}
